---
layout: post
title:  "缓存理解要点"
date:   2023-12-10 09:00:00 +0800
categories: arch chinese
---

## 概念部分

### 1. 什么是组相连、全相连、直接相连

### 2. 组相连中 Way、Set、Offset 的含义

### 3. 缓存为什么以 CacheBlock (Cacheline) 为单位进行管理，L1/L2/L3 是否能用不同 Size 的 CacheBlock

### 4. 维护 Cache Coherence 的两种策略： Directory、Snoop

### 5. 非阻塞的缓存一定中“非阻塞”的含义，它一直是非阻塞的嘛？

### 6. 缓存包含关系 Inclusive、Non-inclusive、Exclusive 的含义（与各自优势）

### 7. 预取算法、替换算法在缓存中发挥哪些作用？

## 总线部分
（括号中为可参考的手册页数，手册版本为 TileLink SPEC 1.8.1）

### 1. ABCDE 各条通道的方向与优先级，它们分别用来传递什么信息
### 2. 各个总线 Opcode 的语义
### 3. 缓存块的状态有几种，它们是怎么发生状态转移的（P61-P64）
### 4. 为什么请求之间会有“打断”的问题（Probe 打断 Acquire 的重要性（P69）、Release 请求打断 Probe 的重要性（P69））
### 5. *给出一个因为请求优先级错误而发生死锁的例子
### 6. 为什么 Grant 和 Release 后续都需要分别跟一个 GrantAck 和 ReleaseAck（P69）

## CPL2 部分
参考代码为 CPL2 的 master 分支 https://github.com/OpenXiangShan/CoupledL2

### 1. 缓存总体框架
### 2. 请求的处理流程
  a. 收到 L1 Acquire，且命中
  b. 收到 L1 Acquire，且缺失，需要从 L3 获取
  c. b 的基础上 + 需要替换
  d. 收到 L3 Probe， 且需要去 Probe L1
### 3. ReqArb / MainPipe 包含几个流水级，分别完成什么任务
### 4. Directory 目录项包含哪些内容
### 5. 状态机的逻辑
  ○ s_ 表示要调度的请求，w_ 表示要等待的应答
  ○ 设置逻辑：在 MainPipe 最后的 alloc_state 部分
  ○ 控制子请求的逻辑：MSHR 中
### 6. 流水线入口阻塞逻辑（ReqArb 里的 BlockA/B/C）
  ○ *如何支持同 set 请求的并发处理（新请求进入主流水线的条件，什么时候需要阻塞新请求）
### 7. GrantBuffer 的作用
  ○ 向上层返回响应（D 通道，一个缓存块包含两个总线上的数据 beat）
  ○ 接收 GrantAck（E 通道）
  ○ 阻塞流水线入口（反压控制）
### 8. RefillBuffer 和 ReleaseBuffer 的作用
### 9. 如何实现高优先级请求对低优先级请求的嵌套
### 10. Cache 别名问题是什么，怎么解决的
### 11. *预取请求的处理

## HuanCun 部分